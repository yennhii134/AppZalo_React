{"ast":null,"code":"import { useState } from \"react\";\nimport Toast from \"react-native-toast-message\";\nimport OTPTextView from \"react-native-otp-textinput\";\nimport axiosInstance from \"../api/axiosInstance\";\nconst useRegister = () => {\n  const [isLoading, setIsLoading] = useState(false);\n  const [systemOTP, setSystemOTP] = useState(null);\n  const [isOTPVerified, setIsOTPVerified] = useState(false);\n  const showToastSuccess = notice => {\n    Toast.show({\n      text1: notice,\n      type: \"success\",\n      topOffset: 0,\n      position: \"top\"\n    });\n  };\n  const showToastError = notice => {\n    Toast.show({\n      text1: notice,\n      type: \"error\",\n      topOffset: 0,\n      position: \"top\"\n    });\n  };\n  const verifyOTP = async (userOTP, systemOTP) => {\n    if (userOTP === systemOTP.otp && systemOTP.expires >= Date.now()) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n  const sendOTP = async email => {\n    const response = await axiosInstance.post(\"/auth/send-otp\", {\n      email\n    });\n    const data = response.data;\n    return data.totp;\n  };\n  const getOTP = async email => {\n    const checkEmai = await check_mail(email);\n    if (checkEmai) {\n      showToastError(\"Email already exists\");\n      setIsLoading(false);\n      return false;\n    } else {\n      try {\n        setIsLoading(true);\n        setIsOTPVerified(false);\n        const otp = await sendOTP(email);\n        if (otp) {\n          showToastSuccess(\"OTP sent to your email\");\n          setIsLoading(false);\n          setSystemOTP(otp);\n          return true;\n        } else {\n          showToastError(\"Failed to send OTP\");\n          setIsLoading(false);\n          return false;\n        }\n      } catch (error) {\n        console.log(error);\n        showToastError(\"Failed to send OTP\");\n        setIsLoading(false);\n        return false;\n      }\n    }\n  };\n  const verifyEmailAndRegister = async (textEmail, otp, textPhone, name, dob, selectedGender, textPW) => {\n    const verified = await verifyOTP(otp, systemOTP);\n    setIsOTPVerified(verified);\n    try {\n      setIsLoading(true);\n      if (verified) {\n        const response = await axiosInstance.post(\"/auth/register\", {\n          phone: textPhone,\n          email: textEmail,\n          password: textPW,\n          name: name,\n          dob: dob,\n          gender: selectedGender.toString(),\n          userOTP: otp\n        });\n        setIsOTPVerified(true);\n        const data = response.data;\n        console.log(data);\n        if (response.status === 201) {\n          setIsLoading(false);\n          showToastSuccess(\"Account created successfully\");\n          return true;\n        } else {\n          setIsLoading(false);\n          showToastError(data.response.message);\n          return false;\n        }\n      } else {\n        showToastError(\"Invalid OTP\");\n        setIsLoading(false);\n        return false;\n      }\n    } catch (error) {\n      console.log(error);\n      setIsOTPVerified(true);\n      setIsLoading(false);\n      showToastError(error.response.data.message);\n      return false;\n    }\n  };\n  const check_mail = async email => {\n    try {\n      const response = await axiosInstance.post(\"/users/check-email\", {\n        email\n      });\n      if (response.status === 404) {\n        return false;\n      } else if (response.status === 200) {\n        return true;\n      } else {\n        return false;\n      }\n    } catch (error) {\n      return false;\n    }\n  };\n  const GetSystemOTP = () => {\n    return systemOTP;\n  };\n  const checkMail = async email => {\n    const checkEmai = await check_mail(email);\n    if (checkEmai) {\n      showToastError(\"Email already exists\");\n      setIsLoading(false);\n      return false;\n    } else {\n      return true;\n    }\n  };\n  return {\n    isOTPVerified,\n    getOTP,\n    verifyEmailAndRegister,\n    showToastError,\n    showToastSuccess,\n    verifyOTP,\n    GetSystemOTP,\n    checkMail\n  };\n};\nexport default useRegister;","map":{"version":3,"names":["useState","Toast","OTPTextView","axiosInstance","useRegister","isLoading","setIsLoading","systemOTP","setSystemOTP","isOTPVerified","setIsOTPVerified","showToastSuccess","notice","show","text1","type","topOffset","position","showToastError","verifyOTP","userOTP","otp","expires","Date","now","sendOTP","email","response","post","data","totp","getOTP","checkEmai","check_mail","error","console","log","verifyEmailAndRegister","textEmail","textPhone","name","dob","selectedGender","textPW","verified","phone","password","gender","toString","status","message","GetSystemOTP","checkMail"],"sources":["D:/HK2_Nam4/CNM/BTL/New_3/AppZalo_CNM/Frontend/Mobile/zalofake/src/hooks/useRegister.js"],"sourcesContent":["import { useState } from \"react\";\r\nimport Toast from \"react-native-toast-message\";\r\nimport OTPTextView from \"react-native-otp-textinput\";\r\nimport axiosInstance from \"../api/axiosInstance\";\r\n\r\nconst useRegister = () => {\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [systemOTP, setSystemOTP] = useState(null);\r\n  const [isOTPVerified, setIsOTPVerified] = useState(false);\r\n\r\n  const showToastSuccess = (notice) => {\r\n    Toast.show({\r\n      text1: notice,\r\n      type: \"success\",\r\n      topOffset: 0,\r\n      position: \"top\",\r\n    });\r\n  };\r\n  const showToastError = (notice) => {\r\n    Toast.show({\r\n      text1: notice,\r\n      type: \"error\",\r\n      topOffset: 0,\r\n      position: \"top\",\r\n    });\r\n  };\r\n\r\n  const verifyOTP = async (userOTP, systemOTP) => {\r\n    if (userOTP === systemOTP.otp && systemOTP.expires >= Date.now()) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const sendOTP = async (email) => {\r\n    const response = await axiosInstance.post(\"/auth/send-otp\", {\r\n      email,\r\n    });\r\n    const data = response.data;\r\n    return data.totp;\r\n  };\r\n\r\n  const getOTP = async (email) => {\r\n    const checkEmai = await check_mail(email);\r\n    if (checkEmai) {\r\n      showToastError(\"Email already exists\");\r\n      setIsLoading(false);\r\n      return false;\r\n    } else {\r\n      try {\r\n        setIsLoading(true);\r\n        setIsOTPVerified(false);\r\n        const otp = await sendOTP(email);\r\n        if (otp) {\r\n          showToastSuccess(\"OTP sent to your email\");\r\n          setIsLoading(false);\r\n          setSystemOTP(otp);\r\n          return true;\r\n        } else {\r\n          showToastError(\"Failed to send OTP\");\r\n          setIsLoading(false);\r\n          return false;\r\n        }\r\n      } catch (error) {\r\n        console.log(error);\r\n        showToastError(\"Failed to send OTP\");\r\n        setIsLoading(false);\r\n        return false;\r\n      }\r\n    }\r\n  };\r\n\r\n  const verifyEmailAndRegister = async (\r\n    textEmail,\r\n    otp,\r\n    textPhone,\r\n    name,\r\n    dob,\r\n    selectedGender,\r\n    textPW\r\n  ) => {\r\n    const verified = await verifyOTP(otp, systemOTP);\r\n    setIsOTPVerified(verified);\r\n    try {\r\n      setIsLoading(true);\r\n      if (verified) {\r\n        const response = await axiosInstance.post(\"/auth/register\", {\r\n          phone: textPhone,\r\n          email: textEmail,\r\n          password: textPW,\r\n          name: name,\r\n          dob: dob,\r\n          gender: selectedGender.toString(),\r\n          userOTP: otp,\r\n        });\r\n        setIsOTPVerified(true);\r\n        const data = response.data;\r\n        console.log(data);\r\n\r\n        if (response.status === 201) {\r\n          setIsLoading(false);\r\n          showToastSuccess(\"Account created successfully\");\r\n          return true;\r\n        } else {\r\n          setIsLoading(false);\r\n          showToastError(data.response.message);\r\n          return false;\r\n        }\r\n      } else {\r\n        showToastError(\"Invalid OTP\");\r\n        setIsLoading(false);\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n      setIsOTPVerified(true);\r\n      setIsLoading(false);\r\n      showToastError(error.response.data.message);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const check_mail = async (email) => {\r\n    try {\r\n      const response = await axiosInstance.post(\"/users/check-email\", {\r\n        email,\r\n      });\r\n      if (response.status === 404) {\r\n        return false;\r\n      } else if (response.status === 200) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  };\r\n  const GetSystemOTP = () => {\r\n    return systemOTP;\r\n  };\r\n\r\n  const checkMail = async (email) => {\r\n    const checkEmai = await check_mail(email);\r\n    if (checkEmai) {\r\n      showToastError(\"Email already exists\");\r\n      setIsLoading(false);\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  };\r\n\r\n  return {\r\n    isOTPVerified,\r\n    getOTP,\r\n    verifyEmailAndRegister,\r\n    showToastError,\r\n    showToastSuccess,\r\n    verifyOTP,\r\n    GetSystemOTP,\r\n    checkMail\r\n  };\r\n};\r\n\r\nexport default useRegister;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}