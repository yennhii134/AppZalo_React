{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport { createContext, useContext, useState, useEffect } from \"react\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport Toast from \"react-native-toast-message\";\nimport axiosInstance from \"../api/axiosInstance\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthContext = createContext();\nexport var useAuthContext = function useAuthContext() {\n  return useContext(AuthContext);\n};\nexport var AuthContextProvider = function AuthContextProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    authUser = _useState2[0],\n    setAuthUser = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    accessToken = _useState4[0],\n    setAccessToken = _useState4[1];\n  var _useState5 = useState(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    refreshToken = _useState6[0],\n    setRefreshToken = _useState6[1];\n  useEffect(function () {\n    var loadData = function () {\n      var _ref2 = _asyncToGenerator(function* () {\n        try {\n          var AuthUser = yield AsyncStorage.getItem(\"authUser\");\n          var AccessToken = yield AsyncStorage.getItem(\"accessToken\");\n          var RefreshToken = yield AsyncStorage.getItem(\"refreshToken\");\n          if (AuthUser) {\n            setAuthUser(JSON.parse(AuthUser));\n          }\n          if (AccessToken) {\n            setAccessToken(JSON.parse(AccessToken));\n          }\n          if (RefreshToken) {\n            setRefreshToken(JSON.parse(RefreshToken));\n          }\n        } catch (error) {\n          throw new Error(\"Error loading data from AsyncStorage:\", error);\n        }\n      });\n      return function loadData() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    loadData();\n  }, []);\n  useEffect(function () {\n    var saveData = function () {\n      var _ref3 = _asyncToGenerator(function* () {\n        try {\n          if (authUser) {\n            yield AsyncStorage.setItem(\"authUser\", JSON.stringify(authUser));\n          }\n          if (accessToken) {\n            console.log(\"save accessToken\", accessToken);\n            yield AsyncStorage.setItem(\"accessToken\", JSON.stringify(accessToken));\n          }\n          if (refreshToken) {\n            yield AsyncStorage.setItem(\"refreshToken\", JSON.stringify(refreshToken));\n          }\n        } catch (error) {\n          throw new Error(\"Error saving data to AsyncStorage:\", error);\n        }\n      });\n      return function saveData() {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n    saveData();\n  }, [authUser, accessToken, refreshToken]);\n  var updateAvatar = function () {\n    var _ref4 = _asyncToGenerator(function* (newAvatarUrl, publicId) {\n      setAuthUser(function (prevUser) {\n        return _objectSpread(_objectSpread({}, prevUser), {}, {\n          profile: _objectSpread(_objectSpread({}, prevUser.profile), {}, {\n            avatar: _objectSpread(_objectSpread({}, prevUser.profile.avatar), {}, {\n              url: newAvatarUrl,\n              public_id: publicId\n            })\n          })\n        });\n      });\n    });\n    return function updateAvatar(_x, _x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var updateBia = function () {\n    var _ref5 = _asyncToGenerator(function* (backgroundUrl, publicId) {\n      setAuthUser(function (prevUser) {\n        return _objectSpread(_objectSpread({}, prevUser), {}, {\n          profile: _objectSpread(_objectSpread({}, prevUser.profile), {}, {\n            background: _objectSpread(_objectSpread({}, prevUser.profile.background), {}, {\n              url: backgroundUrl,\n              public_id: publicId\n            })\n          })\n        });\n      });\n    });\n    return function updateBia(_x3, _x4) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var reloadAuthUser = function () {\n    var _ref6 = _asyncToGenerator(function* () {\n      try {\n        var response = yield axiosInstance.get(\"users/get/me\");\n        if (response.status === 200) {\n          setAuthUser(response.data.user);\n          return true;\n        }\n      } catch (error) {\n        console.log(error);\n        Toast.error({\n          text1: \"Failed to get user information\",\n          type: \"error\"\n        });\n        return false;\n      }\n    });\n    return function reloadAuthUser() {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  return _jsx(AuthContext.Provider, {\n    value: {\n      authUser: authUser,\n      setAuthUser: setAuthUser,\n      accessToken: accessToken,\n      setAccessToken: setAccessToken,\n      refreshToken: refreshToken,\n      setRefreshToken: setRefreshToken,\n      updateAvatar: updateAvatar,\n      updateBia: updateBia,\n      reloadAuthUser: reloadAuthUser\n    },\n    children: children\n  });\n};\nexport default AuthContextProvider;","map":{"version":3,"names":["createContext","useContext","useState","useEffect","AsyncStorage","Toast","axiosInstance","jsx","_jsx","AuthContext","useAuthContext","AuthContextProvider","_ref","children","_useState","_useState2","_slicedToArray","authUser","setAuthUser","_useState3","_useState4","accessToken","setAccessToken","_useState5","_useState6","refreshToken","setRefreshToken","loadData","_ref2","_asyncToGenerator","AuthUser","getItem","AccessToken","RefreshToken","JSON","parse","error","Error","apply","arguments","saveData","_ref3","setItem","stringify","console","log","updateAvatar","_ref4","newAvatarUrl","publicId","prevUser","_objectSpread","profile","avatar","url","public_id","_x","_x2","updateBia","_ref5","backgroundUrl","background","_x3","_x4","reloadAuthUser","_ref6","response","get","status","data","user","text1","type","Provider","value"],"sources":["C:/BaoTruc/iuh/ky2nam4/CNM/DeTai/AppZalo_CNM/Frontend/Mobile/zalofake/src/contexts/AuthContext.js"],"sourcesContent":["import { createContext, useContext, useState, useEffect } from \"react\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport Toast from \"react-native-toast-message\";\r\nimport axiosInstance from \"../api/axiosInstance\";\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuthContext = () => {\r\n  return useContext(AuthContext);\r\n};\r\n\r\n// AsyncStorage.clear();\r\nexport const AuthContextProvider = ({ children }) => {\r\n  const [authUser, setAuthUser] = useState(null);\r\n  const [accessToken, setAccessToken] = useState(null);\r\n  const [refreshToken, setRefreshToken] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const loadData = async () => {\r\n      try {\r\n        const AuthUser = await AsyncStorage.getItem(\"authUser\");\r\n        const AccessToken = await AsyncStorage.getItem(\"accessToken\");\r\n        const RefreshToken = await AsyncStorage.getItem(\"refreshToken\");\r\n        if (AuthUser) {\r\n          setAuthUser(JSON.parse(AuthUser));\r\n        }\r\n        if (AccessToken) {\r\n          setAccessToken(JSON.parse(AccessToken));\r\n        }\r\n        if (RefreshToken) {\r\n          setRefreshToken(JSON.parse(RefreshToken));\r\n        }\r\n      } catch (error) {\r\n        throw new Error(\"Error loading data from AsyncStorage:\", error);\r\n      }\r\n    };\r\n\r\n    loadData();\r\n  }, []);\r\n  useEffect(() => {\r\n    const saveData = async () => {\r\n      try {\r\n        if (authUser) {\r\n          await AsyncStorage.setItem(\"authUser\", JSON.stringify(authUser));\r\n        }\r\n        if (accessToken) {\r\n          console.log(\"save accessToken\", accessToken);\r\n          await AsyncStorage.setItem(\r\n            \"accessToken\",\r\n            JSON.stringify(accessToken)\r\n          );\r\n        }\r\n        if (refreshToken) {\r\n          await AsyncStorage.setItem(\r\n            \"refreshToken\",\r\n            JSON.stringify(refreshToken)\r\n          );\r\n        }\r\n      } catch (error) {\r\n        throw new Error(\"Error saving data to AsyncStorage:\", error);\r\n      }\r\n    };\r\n\r\n    saveData();\r\n  }, [authUser, accessToken, refreshToken]);\r\n  // Hàm cập nhật avatar mới\r\n  const updateAvatar = async (newAvatarUrl, publicId) => {\r\n    setAuthUser((prevUser) => ({\r\n      ...prevUser,\r\n      profile: {\r\n        ...prevUser.profile,\r\n        avatar: {\r\n          ...prevUser.profile.avatar,\r\n          url: newAvatarUrl,\r\n          public_id: publicId,\r\n        },\r\n      },\r\n    }));\r\n  };\r\n  // Hàm cập nhật bìa mới\r\n  const updateBia = async (backgroundUrl, publicId) => {\r\n    setAuthUser((prevUser) => ({\r\n      ...prevUser,\r\n      profile: {\r\n        ...prevUser.profile,\r\n        background: {\r\n          ...prevUser.profile.background,\r\n          url: backgroundUrl,\r\n          public_id: publicId,\r\n        },\r\n      },\r\n    }));\r\n  };\r\n  const reloadAuthUser = async () => {\r\n    try {\r\n      const response = await axiosInstance.get(\"users/get/me\");\r\n      if (response.status === 200) {\r\n        setAuthUser(response.data.user);\r\n        return true;\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n      Toast.error({\r\n        text1: \"Failed to get user information\",\r\n        type: \"error\",\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        authUser,\r\n        setAuthUser,\r\n        accessToken,\r\n        setAccessToken,\r\n        refreshToken,\r\n        setRefreshToken,\r\n        updateAvatar,\r\n        updateBia,\r\n        reloadAuthUser,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default AuthContextProvider;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}